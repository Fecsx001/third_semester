<Window x:Class="AsteroidGame.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:AsteroidGame"
        xmlns:view="clr-namespace:AsteroidGame.View"
        xmlns:model="clr-namespace:AsteroidGameMechanic.Model;assembly=AsteroidGameMechanic"
        mc:Ignorable="d"
        Title="Asteroid Game" 
        Width="{Binding ScreenWidth}" 
        Height="{Binding ScreenHeight, Converter={StaticResource HeightConverter}}"
        WindowStartupLocation="CenterScreen"
        Focusable="True">

    <Window.Resources>
        <view:AsteroidFillConverter x:Key="AsteroidFillConverter"/>
        <view:AsteroidStrokeConverter x:Key="AsteroidStrokeConverter"/>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <view:CraterSizeConverter x:Key="CraterSizeConverter"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> 
            <RowDefinition Height="*"/>    
            <RowDefinition Height="Auto"/> 
        </Grid.RowDefinitions>

        <Menu Grid.Row="0">
            <MenuItem Header="_Game">
                <MenuItem Header="_New Game" Command="{Binding NewGameCommand}"/>
                <MenuItem Header="_Pause/Resume" Command="{Binding TogglePauseCommand}"/>
                <Separator/>
                <MenuItem Header="_Save Game" Command="{Binding SaveGameCommand}"/>
                <MenuItem Header="_Load Game" Command="{Binding LoadGameCommand}"/>
                <Separator/>
                <MenuItem Header="_Reset High Score" Command="{Binding ResetHighScoreCommand}"/>
                <Separator/>
                <MenuItem Header="Exit" Command="{Binding ExitCommand}"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_Controls" Command="{Binding ShowControlsCommand}"/>
                <MenuItem Header="_About" Command="{Binding ShowAboutCommand}"/>
            </MenuItem>
        </Menu>

        <Grid Grid.Row="1" Background="Black" ClipToBounds="True" x:Name="GameArea">
            
            <ItemsControl ItemsSource="{Binding Asteroids}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Canvas/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="model:Asteroid">
                        
                        <Grid x:Name="AsteroidGrid"
                              Width="{Binding Width}" 
                              Height="{Binding Height}"> 
                            
                            <Ellipse Fill="{Binding Converter={StaticResource AsteroidFillConverter}}"
                                     Stroke="{Binding Converter={StaticResource AsteroidStrokeConverter}}"
                                     StrokeThickness="1"/> 
          
                            <Ellipse Fill="DarkSlateGray"
                                     Width="{Binding ElementName=AsteroidGrid, Path=ActualWidth, Converter={StaticResource CraterSizeConverter}, ConverterParameter=0.2}"
                                     Height="{Binding ElementName=AsteroidGrid, Path=ActualWidth, Converter={StaticResource CraterSizeConverter}, ConverterParameter=0.2}"
                                     HorizontalAlignment="Left" VerticalAlignment="Top" 
                                     Margin="5, 8, 0, 0"/>

                            <Ellipse Fill="DarkSlateGray"
                                     Width="{Binding ElementName=AsteroidGrid, Path=ActualWidth, Converter={StaticResource CraterSizeConverter}, ConverterParameter=0.15}"
                                     Height="{Binding ElementName=AsteroidGrid, Path=ActualWidth, Converter={StaticResource CraterSizeConverter}, ConverterParameter=0.15}"
                                     HorizontalAlignment="Center" VerticalAlignment="Center"
                                     Margin="10, 0, 0, 5"/>

                            <Ellipse Fill="DarkSlateGray"
                                     Width="{Binding ElementName=AsteroidGrid, Path=ActualWidth, Converter={StaticResource CraterSizeConverter}, ConverterParameter=0.25}"
                                     Height="{Binding ElementName=AsteroidGrid, Path=ActualWidth, Converter={StaticResource CraterSizeConverter}, ConverterParameter=0.25}"
                                     HorizontalAlignment="Right" VerticalAlignment="Bottom"
                                     Margin="0, 0, 8, 10"/>

                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
                
                <ItemsControl.ItemContainerStyle>
                    <Style TargetType="ContentPresenter">
                        <Setter Property="Canvas.Left" Value="{Binding X}"/>
                        <Setter Property="Canvas.Top" Value="{Binding Y}"/>
                    </Style>
                </ItemsControl.ItemContainerStyle>
            </ItemsControl>
            
            <Grid Margin="{Binding SpaceshipPosition}"
                  Width="{Binding Spaceship.Width}"
                  Height="{Binding Spaceship.Height}"
                  HorizontalAlignment="Left" 
                  VerticalAlignment="Top">
                <Rectangle Fill="LightBlue" Stroke="White" StrokeThickness="1"/>
                <Rectangle Fill="Blue" Stroke="White" StrokeThickness="1"
                           Width="30" Height="10" 
                           HorizontalAlignment="Center" VerticalAlignment="Top" 
                           Margin="0,-10,0,0"/>
                <Polygon Fill="Orange"
                         Width="30" Height="10"
                         HorizontalAlignment="Center" VerticalAlignment="Bottom"
                         Margin="0,0,0,-10"
                         Stretch="Fill"
                         Points="5,0 25,0 30,10 0,10" />
            </Grid>
                
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="PAUSED" 
                           FontSize="48" FontWeight="Bold" Foreground="Yellow"
                           Visibility="{Binding IsPaused, Converter={StaticResource BoolToVis}}"/>
                <TextBlock Text="Press SPACE to resume" 
                           FontSize="20" Foreground="White" TextAlignment="Center"
                           Visibility="{Binding IsPaused, Converter={StaticResource BoolToVis}}"/>
            </StackPanel>

            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center"
                        Visibility="{Binding IsGameOver, Converter={StaticResource BoolToVis}}">
                <TextBlock Text="GAME OVER" 
                           FontSize="48" FontWeight="Bold" Foreground="Red"/>
                <TextBlock Text="Press SPACE to play again" 
                           FontSize="20" Foreground="Yellow" TextAlignment="Center"/>
            </StackPanel>

        </Grid>
        
        <StatusBar Grid.Row="2">
            <StatusBarItem>
                <TextBlock Text="{Binding GameTime, StringFormat='Time: mm\\:ss'}"/>
            </StatusBarItem>
            <StatusBarItem>
                <TextBlock Text="{Binding Score, StringFormat='Score: {0}'}"/>
            </StatusBarItem>
            <StatusBarItem>
                <TextBlock Text="{Binding HighScore, StringFormat='High Score: {0}'}" Foreground="Red"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Text="{Binding Difficulty, StringFormat='Difficulty: {0}'}"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>